# 马拉松第三方集成演示使用指南

## 功能概述

这个演示系统展示了陪你天气如何与第三方马拉松赛事小程序集成，为参赛者提供无缝的天气保障服务。

## 演示流程

### 1. 进入演示模式

1. 在应用中导航到**个人中心**页面
2. 点击**第三方集成演示**选项
3. 进入马拉松赛事列表页面

### 2. 选择赛事

在赛事列表中可以看到6个不同的马拉松赛事案例：

- **2025上海马拉松** - 2025年11月30日，报名费200元
- **2025北京马拉松** - 2025年10月26日，报名费300元
- **2025广州马拉松** - 2025年12月14日，报名费180元
- **2025杭州马拉松** - 2025年11月2日，报名费200元
- **2025厦门马拉松** - 2025年1月5日，报名费160元
- **2025成都马拉松** - 2025年3月23日，报名费220元

点击任一赛事卡片进入该赛事的付款页面。

### 3. 马拉松付款页面

付款页面模拟第三方马拉松小程序，包含：

#### 赛事信息
- 赛事名称、日期、地点
- 起跑时间
- 参赛项目（全程马拉松42.195公里）

#### 参赛者信息
- 姓名、手机号
- 身份证号
- 紧急联系人

#### 天气保障横幅（核心功能）

横幅展示天气保障的关键信息：

- **保障日期**：与比赛日期一致
- **保障地点**：比赛举办城市
- **补偿金额**：基于报名费计算（报名费的50%）
- **监测时段**：08:00-14:00（比赛时段）
- **补偿条件**：比赛时段降雨≥2小时（降雨强度≥1.5mm/h）

**互动功能：**
- 可勾选"添加天气保障"（费用+¥0.20）
- 点击横幅或"了解详情"按钮跳转到陪你天气小程序

#### 支付方式
- 仅支持微信支付（符合微信小程序场景）

### 4. 跳转到陪你天气

点击天气保障横幅后：

1. **过渡动画**：显示"正在跳转到陪你天气..."
2. **数据传递**：自动传递以下信息
   - 来源标识（马拉松赛事ID）
   - 保障地点（比赛城市）
   - 保障日期（比赛日期）
   - 保障金额（报名费）
   - 补偿金额（基于报名费计算）
   - 赛事名称

### 5. 陪你天气首页（自动填充状态）

跳转后的首页展示：

#### 来源标识横幅
- 显著的蓝色横幅标识来源赛事
- 显示"来自 [赛事名称]"
- 提示信息："赛事信息已自动填入，请继续完成天气保障流程"
- 包含返回马拉松小程序的按钮

#### 锁定的表单字段
所有从马拉松传递的数据字段都处于**只读锁定状态**：

- **目的地**：显示比赛城市，右侧有锁定图标🔒
- **开始日期**：显示比赛日期，右侧有锁定图标🔒
- **结束日期**：显示比赛日期，右侧有锁定图标🔒
- **每日行程费用**：显示报名费金额，右侧有锁定图标🔒

字段下方显示提示："此信息由赛事方提供，不可修改"

### 6. 添加天气服务页面

点击"添加天气保障"按钮后：

#### 行程信息卡片
- 自动显示从马拉松传递的数据（带锁定图标）
- 日期、地点、费用信息保持锁定

#### 来源标识
- 顶部显示蓝色横幅："来自 [赛事名称]"
- 说明这是马拉松赛事的天气保障

#### 服务详情（针对马拉松场景定制）
- 文案调整为"陪你天气®将在您的**比赛**当天监测天气状况"
- 监测时段调整为"08:00-14:00"（比赛时段）
- 补偿金额显示为实际计算的金额（如100元）

#### 补偿规则说明
针对马拉松场景的补偿说明：
- 比赛当天08:00-14:00降雨≥2小时
- 降雨强度≥1.5mm/h
- 补偿金额为报名费的50%

#### 联系信息
- 姓名和手机号码输入框保持可编辑
- 提示调整为："陪你天气仅保障[赛事名称]比赛当天的天气，如有需要，我们将要求您提供报名凭证以核实补偿。"

### 7. 完成流程

用户可以：
- 填写联系信息
- 同意服务条款
- 点击"立即购买"完成天气保障购买
- 或点击返回按钮回到马拉松付款页面

## 技术特性

### 数据传递机制
使用 React 状态管理模拟跨小程序数据传递：
```typescript
interface ReferralData {
  source: string;          // 来源标识
  location: string;        // 保障地点
  startDate: string;       // 开始日期
  endDate: string;         // 结束日期
  amount: number;          // 金额
  eventName: string;       // 赛事名称
  compensationAmount: number; // 补偿金额
}
```

### 只读状态实现
- 使用锁定图标（Lock icon）标识不可编辑字段
- 通过条件渲染显示锁定的数据或空白输入框
- 视觉上使用灰色边框和提示文字说明锁定原因

### 数据库支持
在 Supabase 中创建了三个表用于数据追踪：

1. **marathon_events** - 存储马拉松赛事信息
2. **referral_sources** - 记录从第三方跳转的订单来源
3. **demo_sessions** - 记录演示使用情况

## 商业价值展示

这个演示系统展示了：

1. **无缝集成**：第三方应用可以轻松嵌入天气保障服务
2. **自动化流程**：数据自动传递，减少用户输入负担
3. **定制化体验**：针对不同场景（如马拉松）提供定制化的保障方案
4. **B2B潜力**：为与赛事主办方的合作提供清晰的技术方案

## 使用建议

- 演示时从马拉松列表页开始，展示多样性
- 重点展示天气保障横幅的报价信息和补偿规则
- 强调数据自动填充和锁定状态的便捷性
- 说明这如何减少用户的操作步骤
- 讨论与不同类型活动主办方合作的可能性

## 注意事项

- 这是演示模式，不会产生真实订单
- 支付功能仅为演示展示
- 所有马拉松赛事数据为示例数据
- 实际应用中需要与第三方小程序进行真实的数据对接
